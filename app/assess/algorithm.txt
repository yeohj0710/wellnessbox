# 건강기능식품 추천 알고리즘

## 카테고리(22)
비타민C, 오메가3, 칼슘, 루테인, 비타민D, 밀크씨슬(실리마린), 프로바이오틱스(유산균), 비타민B, 마그네슘, 가르시니아, 멀티비타민, 아연, 차전자피 식이섬유, 미네랄, 비타민A, 철분, 포스파티딜세린, 엽산, 아르기닌, 콘드로이친, 코엔자임Q10, 콜라겐

---

## 섹션 A: 기초·생활습관·안전·관심선택(약 15문항)

A1. 성별  
- 값: M/F  
- 배점: 없음(분기용)

A2. 나이(만)  
- 값: 정수  
- 배점: 50세 이상 → 칼슘 +1, 비타민D +1, 코엔자임Q10 +1

A3. 키(cm)  
- 값: 정수

A4. 체중(kg)  
- 값: 소수 허용  
- 파생 가중치(BMI=kg/㎡):  
  - BMI ≥27 → 가르시니아 +1  
  - BMI ≤18.5 → 멀티비타민 +1, 미네랄 +1

A5. 임신/수유  
- 값: 예/아니오  
- 안전/가점: 예 → 비타민A(레티놀) 차단, 가르시니아 차단, 엽산 +3

A6. 항응고제 복용·출혈장애·수술 예정  
- 값: 예/아니오  
- 안전: 예 → 오메가3 ×0.6

A7. 신장결석 병력·만성 신장질환  
- 값: 예/아니오  
- 안전: 예 → 칼슘 ×0.6, 비타민C ×0.7

A8. 간질환 진단·간수치 이상  
- 값: 예/아니오  
- 안전/가점: 예 → 비타민A ×0.6, 밀크씨슬 +1

A9. 철 과잉 진단  
- 값: 예/아니오  
- 안전: 예 → 철분 차단

A10. 관심 카테고리 선택(1–5개 권장)  
- 값: 22개 중 다중선택  
- 배점: 선택 카테고리 각 +3  
- 예외 처리: 0개 선택 시에도 진행, 6개 이상 선택 시 경고 후 상위만 유지

A11. 등푸른 생선 섭취(주)  
- 값: 0/1/2+  
- 배점: 0 → 오메가3 +2, 1 → 오메가3 +1

A12. 평일 햇빛 노출 15분 미만  
- 값: 예/아니오  
- 배점: 예 → 비타민D +2

A13. 유제품 섭취(주)  
- 값: ≤2/3–5/6+  
- 배점: ≤2 → 칼슘 +2, 비타민D +1; 3–5 → 칼슘 +1

A14. 화면 시간(일)  
- 값: <4h/4–5h/≥6h  
- 배점: 4–5h → 루테인 +1; ≥6h → 루테인 +2, 오메가3 +1

A15. 배변 상태  
- 값: 변비/정상/묽음·팽만  
- 배점: 변비 → 차전자피 식이섬유 +2, 프로바이오틱스 +1; 묽음·팽만 → 프로바이오틱스 +2, 차전자피 식이섬유 +1

---

## 섹션 B: 증상·목표(약 16문항)

B16. 지난 2주 피로감(리커트4: 0–3)  
- 값: 0/1/2/3  
- 배점: 2–3 → 비타민B +2, 코엔자임Q10 +1, 마그네슘 +1

B17. 수면 질 나쁨 또는 쥐 잦음  
- 값: 예/아니오  
- 배점: 예 → 마그네슘 +2

B18. 관절 통증 빈도  
- 값: 없음/가끔/자주  
- 배점: 가끔 → 콘드로이친 +1; 자주 → 콘드로이친 +2, 콜라겐 +1, 오메가3 +1

B19. 피부·모발·손톱 고민(다중선택)  
- 값: 피부 탄력 저하/피부 건조/여드름·염증/상처 회복 느림/손톱 갈라짐/모발 푸석  
- 배점:  
  - 탄력↓ 또는 건조 → 콜라겐 +2, 비타민C +1  
  - 여드름·염증 또는 상처회복 느림 → 아연 +2, 비타민C +1  
  - 손톱 갈라짐 또는 모발 푸석 → 콜라겐 +1, 아연 +1, 비타민B +1

B20. 야식·탄수 위주·최근 체중 증가  
- 값: 예/아니오  
- 배점: 예 → 가르시니아 +2, 차전자피 식이섬유 +1

B21. 음주 빈도  
- 값: 거의 없음/주1–2/주3+ 또는 폭음  
- 배점: 주3+ 또는 폭음 → 밀크씨슬 +2, 엽산 +1

B22. 여성: 월경 과다 또는 빈혈 의심  
- 값: 예/아니오/해당 없음  
- 배점: 예 → 철분 +2, 엽산 +1, 비타민C +1

B23. 혈중지질 지적 또는 심혈관 가족력  
- 값: 예/아니오  
- 배점: 예 → 오메가3 +2, 코엔자임Q10 +1

B24. 집중·기억 저하  
- 값: 예/아니오  
- 배점: 예 → 포스파티딜세린 +2, 비타민B +1

B25. 소화 불편·가스·더부룩  
- 값: 예/아니오  
- 배점: 예 → 프로바이오틱스 +2, 차전자피 식이섬유 +1

B26. 잔병치레·감기 잦음  
- 값: 예/아니오  
- 배점: 예 → 비타민C +2, 아연 +1, 비타민D +1

B27. 운동 수행·지구력 향상 욕구  
- 값: 예/아니오  
- 배점: 예 → 아르기닌 +2, 코엔자임Q10 +1, 비타민B +1

B28. 수족 냉증·혈류 불량  
- 값: 예/아니오  
- 배점: 예 → 아르기닌 +2, 코엔자임Q10 +1

B29. 식사 질 저조 또는 끼니 거름  
- 값: 예/아니오  
- 배점: 예 → 멀티비타민 +2, 비타민B +1, 미네랄 +1

B30. 땀 많은 활동 또는 더운 환경 근무  
- 값: 예/아니오  
- 배점: 예 → 미네랄 +2, 마그네슘 +1

B31. 야간운전·저조도 시야 불편  
- 값: 예/아니오  
- 배점: 예 → 루테인 +2, 비타민A +1

---

## 번들 시너지(질문 아님, 규칙)
- 칼슘 → 비타민D +0.5  
- 루테인 → 오메가3 +0.3  
- 비타민B → 마그네슘 +0.2

---

## 스코어링 규칙(섹션 분할 적용)

표기·상수  
- 응답 인코딩: 예=1, 아니오=0, 리커트4=0/1/2/3, 다중선택은 항목별 0/1  
- ε=1e-6  
- Q(정규화 대상 문항 집합) = {A2, A4, A11–A15, B16–B31}  
  (A10은 관심선택 가중, A5–A9는 안전 규칙, 번들은 별도 규칙)

1) 관심선택 점수(총량 고정)  
- w_interest=3  
- w_interest_eff = w_interest × 5 / max(5, S_sel)  
- S_interest(c) = w_interest_eff × sel(c)

2) 트리아지 정규화(노출 편향 제거)  
- “→ 카테고리 +k”는 해당 조건 충족 시 r_q=1, w_qc=k  
- S_tria_num(c) = Σ_{q∈Q} (w_qc × r_q)  
- S_tria_den(c) = Σ_{q∈Q} (max_qc)  
- N_tria(c) = S_tria_num(c) / max(1, S_tria_den(c))

3) 1차 종합점수  
- α=1, β=1  
- S0(c) = α×N_tria(c) + β×S_interest(c)

4) 안전 규칙 적용  
- 차단: S1(c)=0  
- 다운계수 f∈(0,1]: S1(c)=S0(c)×f

5) 번들 시너지  
- S2(c_b) = S1(c_b) + δ×S1(c_a)

6) 후보 선정(항상 3개 목표)  
- 후보 K=3 기준  
- S_sel=0: S2 상위 Top3  
- 1≤S_sel≤5: 선택된 c 우선 포함, 부족분은 S2 상위로 채워 3개  
- S_sel≥6: 경고 후 S2 상위 3개로 자동 축소  
- 안전 적용 후 3개 미만이면, 순위대로 안전 통과 항목으로 보충(없으면 1–2개만 진행)  
- 동률: 관심선택 있음 > 번들 영향 큰 쪽 > 연령/BMI 가점 큰 쪽

---

## 진행 흐름(3섹션 UX)
1) 섹션 A 진행 → 중간 점수 계산(미리보기 가능, 질문 계속)  
2) 섹션 B 진행 → S2 확정 → **세분화 대상 Top3** 선정  
3) 딥 단계: Top3 각각 5문항(총 15문항) + ONNX 추론 → 세 카테고리 간 퍼센티지 산출 및 최종 1·2·3위 확정
