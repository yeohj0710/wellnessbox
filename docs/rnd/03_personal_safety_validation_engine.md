# 목표

- 소비자가 제품 라벨/검색 결과에만 의존해 금기·상호작용·과다복용 등 안전 리스크를 정확히 판단하기 어려운 문제를 해결한다.
- 사용자 상태(개인 특성)와 성분 정보를 기반으로, 안전성 위반 여부를 자동 판정하고 근거(레퍼런스)를 함께 제시한다.
- 결과적으로 사용자가 영양제를 잘못 복용하는 경우가 없도록 “개인화 안전 범위 데이터”를 산출하여, 후속 단계(조합 탐색/최적화 등)에서 안전 제약으로 사용될 수 있게 한다.

# 입력/출력(계약)

## 입력

1. 개인 특성 파라미터(사용자 상태)

- 예: 성별/연령 등 신체적 특성
- 예: 복용 약물, 질환, 알레르기
- 예: 생활·식이 습관
- 예: 관심 분야/건강 목표
- 위 데이터는 UI/UX 입력 및(가능한 경우) 마이데이터 연동 등을 통해 수집되는 것을 전제로 한다.

2. 안전 규칙/근거 데이터(외부)

- 예: 건강기능식품 관련 안전 데이터(금기, 상호작용, 과다복용, 주의사항 등)
- 예: 의·약학 DB 및 학술지 등에서 정의되는 규칙 데이터(안전 규칙의 근거 포함)

3. 성분/제품 정보(서비스 도메인)

- 예: 제품/성분 카테고리, 성분별 용량 정보(가능한 범위 내)
- 예: 복용 규칙(복용 타이밍/주기 등)과 관련된 정보(가능한 범위 내)

## 출력

개인화 안전 범위 데이터(사용자별)

- 성분별 복용량 허용 범위
- 복용 규칙 허용 범위
- 복용 금기 성분(해당 사용자에게 금지)
- 복용 금기 규칙(해당 사용자에게 금지)
- 각 판정 결과에 연결된 레퍼런스(규칙/근거의 출처 및 요약)

# 핵심 기능 요구사항

## 1) 데이터 수집·정제

- 개인 특성 파라미터를 “안전 판정”에 활용 가능한 입력 구조로 정리할 수 있어야 한다.
- 입력 데이터는 규칙 매칭(판정)에 활용 가능하도록 스키마 변환/정규화가 가능해야 한다.

## 2) 규칙 참조·필터링(Rule-based Matching)

- 의·약학 DB/학술지 등으로부터 안전 규칙 데이터를 정의하고, 규칙 테이블 형태로 정렬/배치할 수 있어야 한다.
- 규칙 데이터는 사용자 입력과 대조 가능해야 하며, 사용자에 해당되는 규칙이 적용되어야 한다.
- 규칙 매칭 결과는 “안전성 위반 여부”를 판정할 수 있어야 한다.

## 3) 개인화 안전 범위 데이터 산출

- 사용자별로, 잘못된 복용이 발생하지 않도록(안전화를 목표로) 개인화 안전 범위 데이터를 산출해야 한다.
- 산출물은 후속 단계에서 “영양제 조합의 맞춤형 탐색”에 사용될 수 있어야 한다.

## 4) 레퍼런스 제시 및 요약

- 각 판정 결과는 근거(레퍼런스)를 함께 제공할 수 있어야 한다.
- 레퍼런스는 “수집 및 요약”될 수 있어야 하며, 결과와 연결(추적) 가능해야 한다.

# 비기능 요구사항

## 1) 정확성 및 재현성

- 동일 입력(사용자 상태/규칙 데이터/성분 정보)에 대해 동일한 안전 판정 및 동일한 레퍼런스 연결 결과가 재현 가능해야 한다.

## 2) 추적 가능성(근거 연결)

- 안전 판정 결과가 어떤 규칙/근거 데이터에 의해 도출되었는지 추적 가능해야 한다.

## 3) 개인정보/민감정보 보호

- 개인 특성 파라미터(건강 정보 포함 가능)는 민감정보가 될 수 있으므로, 접근 통제/기록/보관 기준을 준수할 수 있어야 한다.

# 성능지표(KPI)

- 본 모듈의 평가는 `docs/rnd/01_kpi_and_evaluation.md`의 다음 항목을 따른다.
  - 안전/근거: “안전 검증 엔진 제공 데이터 및 Data Lake 레퍼런스 정확도(%)”
  - 안전: “약물이상반응 집계 보고 건수(건/year)”
- 따라서 본 모듈은 위 KPI 산출이 가능하도록,
  - (a) 규칙 매칭 결과(적용된 규칙/판정),
  - (b) 레퍼런스 연결 정보(근거 출처/식별/요약),
  - (c) 사용자별 개인화 안전 범위 데이터(결과 구조)
    를 제공할 수 있어야 한다.

# 평가방법(이 모듈 관점)

- 최종 판정 기준(정확도 계산식/표본 조건/목표치)은 `docs/rnd/01_kpi_and_evaluation.md`를 따른다.
- 본 모듈은 평가 표본(규칙/질의/시나리오)별로 아래가 가능해야 한다.
  - 안전 판정(위반 여부) 결과 출력
  - 결과에 대한 레퍼런스(규칙/근거) 연결 정보 제공
  - 동일 조건에서 반복 실행 가능(재현성)

# 평가환경(이 모듈 관점)

- “외부 공신력 환경”을 전제로 하며, 평가용 데이터셋/평가 절차/결과 리포트를 동일 조건에서 재현 가능하게 보관해야 한다.
