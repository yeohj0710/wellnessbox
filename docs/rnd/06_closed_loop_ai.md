# 목표

- 사용자 건강 상태 변화(복용 전/후) 및 서비스 상호작용(상담, 구매, 복용 지속/중단 등)을 기반으로, 다음 수행 작업을 자동으로 판단하고 수행함으로써 자가적응형(Closed-loop) 케어를 구현한다.
- 사용자별 상태·목표·피드백을 반영하여 추천/상담/후속 조치(유지·변경·중단·재상담 등)가 반복적으로 개선되는 구조를 제공한다.
- 기술개발 성능지표(KPI)인 “다음 수행 작업 판단 및 수행 정확도(%)” 및 “상담 모듈 답변 정확도(%)” 평가가 가능하도록 한다.

# 입력/출력(계약)

## 입력

1. 사용자 상태 데이터

- 개인 특성 파라미터(성별/연령/병력/복용약/알레르기/생활습관/목표 등)
- 효과 측정 데이터(전/후 또는 시계열 관측치) 및 효과 정량화 결과(04)
- (가능한 경우) 바이오센서 기반 관측치(07)

2. 서비스 이벤트/상호작용 데이터

- 상담(대화) 로그 및 상담 결과(요약/결정)
- 구매/재구매/복용 지속·중단, 알림 반응 등 행동 데이터
- 추천/최적화 엔진(05) 결과 및 사용자의 선택 결과

3. 안전성 정보

- 개인화 안전 범위 데이터 및 안전성 검증 결과(03)

## 출력

1. 다음 수행 작업(Next Action) 판단 결과

- 사용자별로 다음에 수행해야 할 작업의 종류(예: 유지/변경/중단/추가상담/추가정보 요청/모니터링 등)
- 작업 수행 결과(성공 여부 포함)

2. 상담 모듈(대화형 LLM) 응답

- 사용자 질의/상담 맥락에 대한 답변 및 안내
- (가능한 경우) 근거/참조 정보 연결(데이터레이크 기반)

3. 평가/재현을 위한 로그

- “정답 작업”과 비교 가능한 형태의 기록(테스트 케이스별)
- 수행 결과 성공 여부 기록(정확도 계산 가능)

# 핵심 기능 요구사항

## 1) 다음 수행 작업 판단(Decision)

- 사용자 상태 변화(효과 측정/정량화 결과), 안전성 결과, 서비스 상호작용 로그를 기반으로 “다음 수행 작업”을 판단할 수 있어야 한다.
- 작업 후보는 최소한 다음 범주를 포함할 수 있어야 한다.
  - 추천 조합 유지
  - 추천 조합 변경(대체/조정)
  - 복용 중단 권고
  - 추가 정보 요청(사용자 입력 필요)
  - 추가 상담(약사/전문가) 유도
  - 모니터링/추적(알림, 재측정, 후속 설문 등)

## 2) 작업 수행(Execution)

- 판단된 작업을 실제로 수행하거나(예: 알림 발송, 재상담 트리거, 재추천 호출 등) 수행 요청을 생성할 수 있어야 한다.
- 수행 결과(성공/실패)가 기록되어야 하며, 평가 가능한 형태로 남아야 한다.

## 3) 상담 모듈(대화형 LLM)

- 사용자 상담/질의에 대해 답변을 생성할 수 있어야 한다.
- 답변의 적절성을 평가할 수 있도록 테스트 문항 기반 평가가 가능해야 한다.
- (가능한 범위에서) 답변 생성 시 근거 데이터(문헌/DB/내부 데이터)를 참조할 수 있어야 한다.

## 4) 피드백 루프(Closed-loop)

- 사용자 반응(선택/행동/효과 변화)과 수행 결과를 축적하고, 이후 판단/추천에 활용될 수 있어야 한다.
- 축적된 데이터는 Data Lake(02)에 저장·재사용 가능해야 한다.

# 비기능 요구사항

## 1) 재현성

- 동일 테스트 입력(케이스/대화 문항/상태 로그)에 대해, 평가 목적의 실행 결과가 재현 가능해야 한다.

## 2) 추적 가능성

- “왜 해당 작업을 선택했는지”를 평가/감사할 수 있도록, 입력 근거(상태/로그/안전성/효과)를 추적 가능해야 한다.

## 3) 개인정보/민감정보 보호

- 상담 로그 및 건강 정보는 민감정보가 될 수 있으므로, 접근 통제/기록/보관 기준을 준수할 수 있어야 한다.

# 성능지표(KPI)

- 본 모듈은 `docs/rnd/01_kpi_and_evaluation.md`의 KPI 산출을 지원해야 한다.
  - Closed-loop: 다음 수행 작업 판단 및 수행 정확도(%) 목표 80%
  - Closed-loop: 상담 모듈(대화형 LLM) 답변 정확도(%) 목표 91%

# 평가방법(이 모듈 관점)

- 최종 KPI 계산식/판정 기준은 `docs/rnd/01_kpi_and_evaluation.md`를 따른다.
- 본 모듈은 아래 평가가 가능하도록 테스트 케이스/로그를 제공해야 한다.

## 1) 다음 수행 작업 판단 및 수행 정확도 평가

- 테스트 케이스(최소 100 case 이상)별로,
  - 정답 작업(목표 작업)과 시스템 선택 작업을 비교 가능해야 한다.
  - 수행 성공 여부(e=1/0)를 기록할 수 있어야 한다.

## 2) 상담 모듈 답변 정확도 평가

- 테스트 문항(최소 100문항 이상)별로,
  - 시스템 답변을 저장하고,
  - 적절성 판정 함수(g) 적용 결과를 산출 가능해야 한다.

# 평가환경(이 모듈 관점)

- “외부 공신력 환경”에서 평가가 가능하도록, 평가 데이터셋(또는 생성 규칙), 평가 절차, 결과 리포트가 동일 조건에서 재현 가능하게 보관되어야 한다.
- 평가 환경에는 최소한 다음 데이터가 포함될 수 있어야 한다.
  - 사용자 상태/목표 데이터
  - 상호작용 로그(상담/행동)
  - 효과 정량화 결과(04) 및 안전성 결과(03)
