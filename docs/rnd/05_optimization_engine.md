# 목표

- 사용자 개인 특성(선택적 특성 포함)과 건강 목표를 입력으로 받아, 건강기능식품(영양제) “조합”을 자동으로 탐색하고 최적 조합 후보(Top-k)를 산출한다.
- 조합은 “효과(효능) 극대화”를 목표로 하되, “부작용/부작용 위험” 및 “가격 부담”을 낮추는 방향을 함께 고려한다.
- 안전성 검증 결과(개인화 안전 범위 데이터)를 제약 조건으로 반영하여, 안전성 위반 조합이 추천되지 않도록 한다.
- 산출된 후보 조합은 사용자 선택(또는 후속 의사결정) 단계로 연결될 수 있어야 한다.

# 입력/출력(계약)

## 입력

1. 사용자 정보(개인 특성 파라미터)

- 예: 성별/연령/키/체중 등 신체 특성
- 예: 병력/증상, 복용 약물, 알레르기, 생활습관, 건강 목표 등
- 입력은 UI/UX 입력 및(가능한 경우) 연동 데이터에 의해 제공될 수 있다.

2. 후보 아이템(영양제/성분/제품) 정보

- 예: 제품/성분 리스트, 카테고리, 가격 정보(가능한 범위), 기본 복용 정보(가능한 범위)
- 예: 도메인 근거 데이터(효능 관련 근거, 대상 지표 등) 또는 이를 참조할 수 있는 식별 정보

3. 효과(효능) 관련 정량 정보(가능한 범위)

- 예: 효과 정량화 모델(04)에서 산출되는 점수/예측값/랭킹 신호
- 예: 과거 사용자 유사도/집단 통계 등(가능한 범위)

4. 안전성 제약 정보

- `docs/rnd/03_personal_safety_validation_engine.md`의 출력인 개인화 안전 범위 데이터(금기 성분/규칙, 허용 범위 등)

5. 사용자 선호/제약(가능한 범위)

- 예: 예산(월 비용), 복용 편의성(알 수/횟수), 특정 성분/제품 선호 또는 회피 등

## 출력

1. 최적 조합 후보(Top-k)

- 사용자에게 제안 가능한 조합 후보 목록
- 후보별로 포함된 제품/성분 구성(조합 결과)

2. 후보별 평가 정보(후속 판단 및 재현을 위해)

- 후보별 예상 효과(또는 효과 관련 점수/순위 근거가 되는 값)
- 후보별 제약 충족 여부(특히 안전성 위반 여부가 없음을 확인할 수 있는 정보)
- 후보별 비용 정보(가능한 범위)

# 핵심 기능 요구사항

## 1) 조합 탐색 및 후보 산출

- 다수 후보 아이템(제품/성분) 중에서 사용자의 목표를 만족하는 조합을 탐색하고, 우수한 후보를 Top-k로 산출할 수 있어야 한다.
- 후보는 단일 제품 추천이 아니라 “조합(세트)” 형태로 산출될 수 있어야 한다.

## 2) 다목적 최적화(효과/부작용/비용)

- 조합 산출 과정에서 아래 요소를 동시에 고려할 수 있어야 한다.
  - 효과(효능) 극대화
  - 부작용 위험 및 부작용 부담 최소화
  - 가격 부담 최소화
- 위 요소의 구체 결합 방식(가중합/우선순위/파레토 등)은 강제하지 않으나, 결과적으로 “효과 + 안전 + 가격”의 균형을 반영한 후보가 산출되어야 한다.

## 3) 안전성 제약 반영

- 개인화 안전 검증 엔진(03)의 결과(금기/주의/허용 범위)를 제약 조건으로 반영하여,
  - 안전성 위반 후보가 산출되지 않거나,
  - 위반 후보는 명확히 배제/필터링될 수 있어야 한다.

## 4) 사용자 선택 단계로의 연결

- Top-k 후보는 사용자가 최종 선택할 수 있는 형태로 제공될 수 있어야 한다.
- 사용자 선택 결과는 후속 모듈(Closed-loop AI, 효과 정량화 피드백 등)에 활용될 수 있어야 한다.

# 비기능 요구사항

## 1) 재현성

- 동일 입력(사용자 상태/후보 아이템/안전성 제약/선호 제약) 조건에서는 동일한 후보 조합 결과가 재현 가능해야 한다(평가/검증 목적).

## 2) 추적 가능성

- 추천된 조합 후보가 어떤 입력(후보 아이템/제약/효과 신호)을 근거로 산출되었는지 추적 가능해야 한다.

## 3) 개인정보/민감정보 보호

- 사용자 상태(건강 정보 포함 가능)는 민감정보가 될 수 있으므로, 접근 통제/기록/보관 기준을 준수할 수 있어야 한다.

# 성능지표(KPI)

- 본 모듈은 `docs/rnd/01_kpi_and_evaluation.md`의 KPI 산출을 지원해야 한다.
  - 추천/최적화: 건강기능식품 추천 정확도(%) 목표 80%
  - 효과: 엔진 추천 복용을 통한 실제 효과 측정치 개선도(pp) 목표 0pp 초과(유의한 개선)
- 또한 본 모듈은 안전성 제약(03)을 위반하지 않는 후보를 산출할 수 있어야 하며, 안전/근거 KPI 측정이 가능하도록 필요한 근거/로그를 제공할 수 있어야 한다.

# 평가방법(이 모듈 관점)

- 최종 KPI 계산식/판정 기준은 `docs/rnd/01_kpi_and_evaluation.md`를 따른다.
- 본 모듈은 최소한 아래 평가가 가능하도록 결과를 제공해야 한다.
  1. 추천 정확도 평가를 위한 조합 출력
     - 테스트 케이스별로 “엔진이 산출한 조합의 성분 합집합(또는 동등한 비교 단위)”을 산출 가능해야 한다.
  2. 효과 개선도(pp) 평가를 위한 개입(추천/복용) 연결
     - (가능한 범위에서) 추천 조합이 실제 복용/측정 데이터와 연결될 수 있어야 한다.
  3. 안전성 제약 준수 확인
     - 산출 후보가 안전성 위반(금기/허용 범위 초과 등)이 아님을 확인 가능한 정보가 제공되어야 한다.

# 평가환경(이 모듈 관점)

- “외부 공신력 환경”에서 평가가 가능하도록, 평가용 데이터셋(또는 생성 규칙), 평가 절차, 결과 리포트가 동일 조건에서 재현 가능하게 보관되어야 한다.
- 최소 평가 데이터 요건:
  - 사용자 케이스(개인 특성/목표) 최소 100 case 이상(추천 정확도 KPI 조건)
  - 후보 아이템(제품/성분) 및 안전성 규칙/근거 데이터가 포함된 환경

# 재현 가능한 산출물

- 평가 케이스 정의(사용자 입력/목표/제약)
- 후보 아이템 목록(평가 시점 기준 버전/범위)
- 각 케이스별 Top-k 조합 출력(조합 구성, 비용 정보(가능 시), 안전성 제약 충족 확인 정보)
- 추천 정확도 산출을 위한 비교 단위(성분 집합 또는 동등 단위) 출력
- 평가 실행 절차(스크립트/쿼리/설정 또는 동등한 재현 가능 수단)
